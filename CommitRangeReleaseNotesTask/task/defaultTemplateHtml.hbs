{{! HTML Release Notes Template }}

<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Release Notes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
    }

    h1,
    h2,
    h3 {
      color: #2c3e50;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 2em;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
    }

    th {
      background: #f4f4f4;
    }

    .summary-list li {
      margin-bottom: 0.5em;
    }

    .muted {
      color: #888;
      font-style: italic;
    }

    hr {
      margin: 2em 0;
    }

    ul {
      margin-top: 0.5em;
      ;
    }

    tr:hover {
      background-color: #f0f8ff;
    }

    .expandable-row {
      cursor: pointer;
      transition: background 0.2s;
    }

    .expandable-row:active {
      background: #e0eaff;
    }

    .description-row td {
      background: #f9f9f9;
      border-top: none;
      font-size: 0.95em;
    }
  </style>
</head>

<body>
  <h1>Release Notes</h1>
  <p class="muted">
    Generated on {{moment generatedDate "DD/MM/YYYY HH:mm"}} from <strong>{{startCommit}}</strong> to
    <strong>{{endCommit}}</strong>
  </p>
  <p><strong>Repository:</strong> {{repositoryId}}</p>
  <hr>

  <h2>ðŸ“Š Summary</h2>
  <ul class="summary-list">
    <li><strong>{{pullRequests.length}}</strong> Pull Requests</li>
    {{#if workItems.length}}
    <li><strong>{{workItems.length}}</strong> Work Items
      <ul>
        {{#groupBy workItems "workItemType"}}
        <li><strong>{{key}}s:</strong> {{items.length}}</li>
        {{/groupBy}}
      </ul>
    </li>
    {{/if}}
  </ul>

  {{#if workItems.length}}
  <h2>ðŸ“‹ Work Items</h2>
  {{#groupBy workItems "workItemType"}}
  <h3>{{key}}s ({{items.length}})</h3>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Assignee</th>
        <th>Linked PRs</th>
      </tr>
    </thead>
    <tbody>
      {{#each items}}
      <tr class="expandable-row" data-row-id="workitem-{{id}}">
        <td><a href="{{url}}">{{id}}</a></td>
        <td>{{title}}</td>
        <td>
          {{#if assignedTo}}
          {{#if assignedTo.imageUrl}}
          <img src="{{assignedTo.imageUrl}}" alt="{{assignedTo.displayName}}"
            style="width:24px;height:24px;border-radius:50%;vertical-align:middle;margin-right:6px;"
            onerror="this.style.display='none';">
          {{/if}}
          {{assignedTo.displayName}}
          {{else}}
          &mdash;
          {{/if}}
        </td>
        <td>
          {{#if pullRequests.length}}
          {{#each pullRequests}}
          <a href="{{url}}">{{id}}</a>{{#unless @last}}, {{/unless}}
          {{/each}}
          {{else}}
          &mdash;
          {{/if}}
        </td>
      </tr>
      <tr class="description-row" id="desc-workitem-{{id}}" style="display:none;">
        <td colspan="4">
          <strong>Description:</strong>
          {{#if description}}
          {{description}}
          {{else}}
          <span class="muted">No description available.</span>
          {{/if}}
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  {{/groupBy}}
  {{else}}
  <p class="muted">No work items in this range.</p>
  {{/if}}
  <hr>

  {{#if pullRequests.length}}
  <h2>ðŸ”€ Pull Requests</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Author</th>
        <th>Linked Work Items</th>
      </tr>
    </thead>
    <tbody>
      {{#each pullRequests}}
      <tr class="expandable-row" data-row-id="pr-{{id}}">
        <td><a href="{{url}}">{{id}}</a></td>
        <td>{{title}}</td>
        <td>
          {{#if author}}
          {{author}}
          {{else}}
          &mdash;
          {{/if}}
        </td>
        <td>
          {{#if workItems.length}}
          {{#each workItems}}
          <a href="{{url}}">{{id}}</a>{{#unless @last}}, {{/unless}}
          {{/each}}
          {{else}}
          &mdash;
          {{/if}}
        </td>
      </tr>
      <tr class="description-row" id="desc-pr-{{id}}" style="display:none;">
        <td colspan="4">
          <strong>Description:</strong>
          {{#if description}}
          {{description}}
          {{else}}
          <span class="muted">No description available.</span>
          {{/if}}
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  {{else}}
  <p class="muted">No pull requests in this range.</p>
  {{/if}}

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.expandable-row').forEach(function (row) {
        row.addEventListener('click', function () {
          var id = row.getAttribute('data-row-id');
          var descRow = document.getElementById('desc-' + id);
          if (descRow) {
            descRow.style.display = descRow.style.display === 'none' ? '' : 'none';
          }
        });
      });
    });
  </script>
</body>

</html>